// @ts-nocheck

import { ChatPage, EndpointCategory, WKApp, Menus } from "@yuwo/base";
import { ContactsList } from "@yuwo/contacts";
import React from "react";
import "./index.css";
import AppLayout from "../Layout";
import { WKSDK } from "wukongimjssdk";

function App() {
  registerMenus();
  return <AppLayout />;
}

async function registerMenus() {
  WKSDK.shared().conversationManager.addConversationListener(() => {
    WKApp.menus.refresh();
  });

  WKApp.endpointManager.setMethod(
    "menus.friendapply.change",
    () => {
      WKApp.menus.refresh();
    },
    {
      category: EndpointCategory.friendApplyDataChange,
    }
  );

  WKApp.menus.register(
    "chat",
    (_context) => {
      const m = new Menus(
        "chat",
        "/",
        "会话",
        (
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_195_5458)">
              <path
                d="M16.0465 8.40002H9.15349C8.95365 8.40002 8.762 8.46899 8.62069 8.59174C8.47939 8.71449 8.4 8.88097 8.4 9.05457C8.4 9.22817 8.47939 9.39465 8.62069 9.5174C8.762 9.64016 8.95365 9.70912 9.15349 9.70912H16.0465C16.2464 9.70912 16.438 9.64016 16.5793 9.5174C16.7206 9.39465 16.8 9.22817 16.8 9.05457C16.8 8.88097 16.7206 8.71449 16.5793 8.59174C16.438 8.46899 16.2464 8.40002 16.0465 8.40002ZM14.8605 11.8909H10.3395C10.1397 11.8909 9.94805 11.9599 9.80674 12.0826C9.66543 12.2054 9.58605 12.3719 9.58605 12.5455C9.58605 12.7191 9.66543 12.8856 9.80674 13.0083C9.94805 13.1311 10.1397 13.2 10.3395 13.2H14.8605C15.0603 13.2 15.252 13.1311 15.3933 13.0083C15.5346 12.8856 15.614 12.7191 15.614 12.5455C15.614 12.3719 15.5346 12.2054 15.3933 12.0826C15.252 11.9599 15.0603 11.8909 14.8605 11.8909Z"
                fill="#000"
              />
              <path
                d="M17.6221 4.99998C18.2815 4.99998 18.9138 5.24581 19.3801 5.68339C19.8463 6.12098 20.1083 6.71447 20.1083 7.33331V14.8C20.1083 15.4188 19.8463 16.0123 19.3801 16.4499C18.9138 16.8875 18.2815 17.1333 17.6221 17.1333H8.8645L8.53757 17.2955L5.09171 19V7.33331C5.09171 6.71447 5.35365 6.12098 5.8199 5.68339C6.28615 5.24581 6.91852 4.99998 7.5779 4.99998H17.6221ZM17.6221 3.59998H7.5779C6.52289 3.59998 5.5111 3.99331 4.7651 4.69344C4.0191 5.39358 3.6 6.34317 3.6 7.33331V19C3.6 19.3713 3.75716 19.7274 4.03691 19.9899C4.31666 20.2525 4.69608 20.4 5.09171 20.4C5.33465 20.3998 5.57377 20.3433 5.78784 20.2355L9.23494 18.5333H17.6221C18.6771 18.5333 19.6889 18.14 20.4349 17.4398C21.1809 16.7397 21.6 15.7901 21.6 14.8V7.33331C21.6 6.34317 21.1809 5.39358 20.4349 4.69344C19.6889 3.99331 18.6771 3.59998 17.6221 3.59998Z"
                fill="#000"
              />
            </g>
            <defs>
              <clipPath id="clip0_195_5458">
                <rect width="24" height="24" fill="#000" />
              </clipPath>
            </defs>
          </svg>
        ),
        (
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_195_5458)">
              <path
                d="M16.0465 8.40002H9.15349C8.95365 8.40002 8.762 8.46899 8.62069 8.59174C8.47939 8.71449 8.4 8.88097 8.4 9.05457C8.4 9.22817 8.47939 9.39465 8.62069 9.5174C8.762 9.64016 8.95365 9.70912 9.15349 9.70912H16.0465C16.2464 9.70912 16.438 9.64016 16.5793 9.5174C16.7206 9.39465 16.8 9.22817 16.8 9.05457C16.8 8.88097 16.7206 8.71449 16.5793 8.59174C16.438 8.46899 16.2464 8.40002 16.0465 8.40002ZM14.8605 11.8909H10.3395C10.1397 11.8909 9.94805 11.9599 9.80674 12.0826C9.66543 12.2054 9.58605 12.3719 9.58605 12.5455C9.58605 12.7191 9.66543 12.8856 9.80674 13.0083C9.94805 13.1311 10.1397 13.2 10.3395 13.2H14.8605C15.0603 13.2 15.252 13.1311 15.3933 13.0083C15.5346 12.8856 15.614 12.7191 15.614 12.5455C15.614 12.3719 15.5346 12.2054 15.3933 12.0826C15.252 11.9599 15.0603 11.8909 14.8605 11.8909Z"
                fill="#000"
              />
              <path
                d="M17.6221 4.99998C18.2815 4.99998 18.9138 5.24581 19.3801 5.68339C19.8463 6.12098 20.1083 6.71447 20.1083 7.33331V14.8C20.1083 15.4188 19.8463 16.0123 19.3801 16.4499C18.9138 16.8875 18.2815 17.1333 17.6221 17.1333H8.8645L8.53757 17.2955L5.09171 19V7.33331C5.09171 6.71447 5.35365 6.12098 5.8199 5.68339C6.28615 5.24581 6.91852 4.99998 7.5779 4.99998H17.6221ZM17.6221 3.59998H7.5779C6.52289 3.59998 5.5111 3.99331 4.7651 4.69344C4.0191 5.39358 3.6 6.34317 3.6 7.33331V19C3.6 19.3713 3.75716 19.7274 4.03691 19.9899C4.31666 20.2525 4.69608 20.4 5.09171 20.4C5.33465 20.3998 5.57377 20.3433 5.78784 20.2355L9.23494 18.5333H17.6221C18.6771 18.5333 19.6889 18.14 20.4349 17.4398C21.1809 16.7397 21.6 15.7901 21.6 14.8V7.33331C21.6 6.34317 21.1809 5.39358 20.4349 4.69344C19.6889 3.99331 18.6771 3.59998 17.6221 3.59998Z"
                fill="#000"
              />
            </g>
            <defs>
              <clipPath id="clip0_195_5458">
                <rect width="24" height="24" fill="#000" />
              </clipPath>
            </defs>
          </svg>
        )
      );
      let badge = 0;

      for (const conversation of WKSDK.shared().conversationManager
        .conversations) {
        badge += conversation.unread;
      }

      m.badge = badge;

      if ((window as any).__POWERED_ELECTRON__) {
        (window as any).ipc.send("conversation-anager-unread-count", badge);
      }

      return m;
    },
    1000
  );

  // 获取好友未申请添加数量
  // let unreadCount = 0;
  if (WKApp.loginInfo.isLogined()) {
    WKApp.apiClient.get(`/user/reddot/friendApply`).then((res) => {
      // unreadCount = res.count;
      WKApp.mittBus.emit("friend-applys-unread-count", res.count);
      WKApp.loginInfo.setStorageItem(
        `${WKApp.loginInfo.uid}-friend-applys-unread-count`,
        res.count
      );
      WKApp.menus.refresh();
    });
  }

  WKApp.menus.register(
    "contacts",
    (param) => {
      const m = new Menus(
        "contacts",
        "/contacts",
        "通讯录",
        (
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.2412 13.4678C7.43315 13.4678 5.14867 11.1831 5.14867 8.37489C5.14867 5.56667 7.43317 3.28198 10.2412 3.28198C13.0492 3.28198 15.3337 5.56667 15.3337 8.37489C15.3337 11.1831 13.0492 13.4678 10.2412 13.4678ZM10.2412 4.77414C8.25586 4.77414 6.6407 6.38942 6.6407 8.37489C6.6407 10.3604 8.25586 11.9756 10.2412 11.9756C12.2265 11.9756 13.8417 10.3603 13.8417 8.37486C13.8417 6.38939 12.2265 4.77414 10.2412 4.77414Z"
              fill="#74A5FF"
            />
            <path
              d="M17.3439 20.5689C16.9319 20.5689 16.5979 20.2349 16.5979 19.8228C16.5979 18.1253 15.9369 16.5294 14.7366 15.3291C13.5364 14.1288 11.9406 13.4677 10.2432 13.4677C8.54577 13.4677 6.94996 14.1287 5.74974 15.329C4.54946 16.5294 3.88847 18.1253 3.88847 19.8228C3.88847 20.2349 3.55444 20.5689 3.14244 20.5689C2.73044 20.5689 2.39644 20.2349 2.39644 19.8228C2.39644 17.7268 3.21266 15.7561 4.69467 14.274C6.17674 12.7918 8.14721 11.9755 10.2432 11.9755C12.3391 11.9755 14.3096 12.7918 15.7917 14.274C17.2737 15.7561 18.0899 17.7267 18.0899 19.8228C18.0899 20.2349 17.7559 20.5689 17.3439 20.5689ZM15.6522 12.9985C15.2402 12.9985 14.9062 12.6644 14.9062 12.2524C14.9062 11.8404 15.2402 11.5063 15.6522 11.5063C16.9954 11.5063 18.0881 10.4135 18.0881 9.07021C18.0881 8.5388 17.9203 8.03399 17.6026 7.61044C17.2948 7.20002 16.8572 6.89143 16.3704 6.74153C15.9766 6.62026 15.7557 6.2027 15.877 5.80894C15.9982 5.41518 16.4157 5.19415 16.8095 5.3155C17.5953 5.55747 18.3008 6.05457 18.7963 6.71522C19.3091 7.39912 19.5802 8.21345 19.5802 9.07026C19.5802 11.2363 17.8182 12.9985 15.6522 12.9985Z"
              fill="#333333"
            />
            <path
              d="M20.8504 18.1971C20.4384 18.1971 20.1044 17.863 20.1044 17.451C20.1044 14.9959 18.1072 12.9985 15.6522 12.9985C15.2402 12.9985 14.9062 12.6644 14.9062 12.2524C14.9062 11.8404 15.2402 11.5063 15.6522 11.5063C17.2399 11.5063 18.7327 12.1247 19.8554 13.2475C20.9781 14.3703 21.5964 15.8632 21.5964 17.451C21.5964 17.8631 21.2625 18.1971 20.8504 18.1971Z"
              fill="#333333"
            />
            <path
              d="M10.24 13.4678C7.43203 13.4678 5.14754 11.1831 5.14754 8.37489C5.14754 5.56667 7.43205 3.28198 10.24 3.28198C13.048 3.28198 15.3326 5.56667 15.3326 8.37489C15.3326 11.1831 13.0481 13.4678 10.24 13.4678ZM10.24 4.77414C8.25474 4.77414 6.63958 6.38942 6.63958 8.37489C6.63958 10.3604 8.25474 11.9756 10.24 11.9756C12.2254 11.9756 13.8406 10.3603 13.8406 8.37486C13.8406 6.38939 12.2254 4.77414 10.24 4.77414Z"
              fill="#333333"
            />
            <path
              d="M17.3428 20.5689C16.9308 20.5689 16.5968 20.2349 16.5968 19.8229C16.5968 18.1254 15.9358 16.5294 14.7355 15.3291C13.5352 14.1288 11.9395 13.4677 10.2421 13.4677C8.54464 13.4677 6.94884 14.1288 5.74861 15.3291C4.54833 16.5295 3.88734 18.1254 3.88734 19.8229C3.88734 20.2349 3.55332 20.569 3.14132 20.569C2.72931 20.569 2.39531 20.2349 2.39531 19.8229C2.39531 17.7268 3.21154 15.7562 4.69355 14.274C6.17562 12.7918 8.14608 11.9756 10.242 11.9756C12.338 11.9756 14.3085 12.7918 15.7905 14.274C17.2726 15.7562 18.0888 17.7268 18.0888 19.8229C18.0888 20.2349 17.7547 20.5689 17.3428 20.5689Z"
              fill="#333333"
            />
          </svg>
        ),
        (
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.2412 13.4678C7.43315 13.4678 5.14867 11.1831 5.14867 8.37489C5.14867 5.56667 7.43317 3.28198 10.2412 3.28198C13.0492 3.28198 15.3337 5.56667 15.3337 8.37489C15.3337 11.1831 13.0492 13.4678 10.2412 13.4678ZM10.2412 4.77414C8.25586 4.77414 6.6407 6.38942 6.6407 8.37489C6.6407 10.3604 8.25586 11.9756 10.2412 11.9756C12.2265 11.9756 13.8417 10.3603 13.8417 8.37486C13.8417 6.38939 12.2265 4.77414 10.2412 4.77414Z"
              fill="#74A5FF"
            />
            <path
              d="M17.3439 20.5689C16.9319 20.5689 16.5979 20.2349 16.5979 19.8228C16.5979 18.1253 15.9369 16.5294 14.7366 15.3291C13.5364 14.1288 11.9406 13.4677 10.2432 13.4677C8.54577 13.4677 6.94996 14.1287 5.74974 15.329C4.54946 16.5294 3.88847 18.1253 3.88847 19.8228C3.88847 20.2349 3.55444 20.5689 3.14244 20.5689C2.73044 20.5689 2.39644 20.2349 2.39644 19.8228C2.39644 17.7268 3.21266 15.7561 4.69467 14.274C6.17674 12.7918 8.14721 11.9755 10.2432 11.9755C12.3391 11.9755 14.3096 12.7918 15.7917 14.274C17.2737 15.7561 18.0899 17.7267 18.0899 19.8228C18.0899 20.2349 17.7559 20.5689 17.3439 20.5689ZM15.6522 12.9985C15.2402 12.9985 14.9062 12.6644 14.9062 12.2524C14.9062 11.8404 15.2402 11.5063 15.6522 11.5063C16.9954 11.5063 18.0881 10.4135 18.0881 9.07021C18.0881 8.5388 17.9203 8.03399 17.6026 7.61044C17.2948 7.20002 16.8572 6.89143 16.3704 6.74153C15.9766 6.62026 15.7557 6.2027 15.877 5.80894C15.9982 5.41518 16.4157 5.19415 16.8095 5.3155C17.5953 5.55747 18.3008 6.05457 18.7963 6.71522C19.3091 7.39912 19.5802 8.21345 19.5802 9.07026C19.5802 11.2363 17.8182 12.9985 15.6522 12.9985Z"
              fill="#333333"
            />
            <path
              d="M20.8504 18.1971C20.4384 18.1971 20.1044 17.863 20.1044 17.451C20.1044 14.9959 18.1072 12.9985 15.6522 12.9985C15.2402 12.9985 14.9062 12.6644 14.9062 12.2524C14.9062 11.8404 15.2402 11.5063 15.6522 11.5063C17.2399 11.5063 18.7327 12.1247 19.8554 13.2475C20.9781 14.3703 21.5964 15.8632 21.5964 17.451C21.5964 17.8631 21.2625 18.1971 20.8504 18.1971Z"
              fill="#333333"
            />
            <path
              d="M10.24 13.4678C7.43203 13.4678 5.14754 11.1831 5.14754 8.37489C5.14754 5.56667 7.43205 3.28198 10.24 3.28198C13.048 3.28198 15.3326 5.56667 15.3326 8.37489C15.3326 11.1831 13.0481 13.4678 10.24 13.4678ZM10.24 4.77414C8.25474 4.77414 6.63958 6.38942 6.63958 8.37489C6.63958 10.3604 8.25474 11.9756 10.24 11.9756C12.2254 11.9756 13.8406 10.3603 13.8406 8.37486C13.8406 6.38939 12.2254 4.77414 10.24 4.77414Z"
              fill="#333333"
            />
            <path
              d="M17.3428 20.5689C16.9308 20.5689 16.5968 20.2349 16.5968 19.8229C16.5968 18.1254 15.9358 16.5294 14.7355 15.3291C13.5352 14.1288 11.9395 13.4677 10.2421 13.4677C8.54464 13.4677 6.94884 14.1288 5.74861 15.3291C4.54833 16.5295 3.88734 18.1254 3.88734 19.8229C3.88734 20.2349 3.55332 20.569 3.14132 20.569C2.72931 20.569 2.39531 20.2349 2.39531 19.8229C2.39531 17.7268 3.21154 15.7562 4.69355 14.274C6.17562 12.7918 8.14608 11.9756 10.242 11.9756C12.338 11.9756 14.3085 12.7918 15.7905 14.274C17.2726 15.7562 18.0888 17.7268 18.0888 19.8229C18.0888 20.2349 17.7547 20.5689 17.3428 20.5689Z"
              fill="#333333"
            />
          </svg>
        )
      );
      m.badge = WKApp.shared.getFriendApplysUnreadCount();
      return m;
    },
    4000
  );

  // WKApp.menus.register(
  //   "favorite",
  //   (param) => {
  //     const m = new Menus(
  //       "favorite",
  //       "/favorite",
  //       "收藏",
  //       (
  //         <svg
  //           width="20"
  //           height="20"
  //           viewBox="0 0 20 20"
  //           fill="none"
  //           xmlns="http://www.w3.org/2000/svg"
  //         >
  //           <path
  //             d="M9.54903 1.9419C9.73038 1.56313 10.2696 1.56313 10.451 1.9419L12.7692 6.78373C12.8421 6.93597 12.9869 7.04115 13.1542 7.06343L18.4754 7.77199C18.8917 7.82742 19.0583 8.34027 18.7541 8.62979L14.8656 12.3308C14.7434 12.4471 14.6881 12.6173 14.7186 12.7833L15.6891 18.0631C15.765 18.4761 15.3287 18.7931 14.9594 18.5932L10.2379 16.0387C10.0895 15.9584 9.91052 15.9584 9.76207 16.0387L5.04063 18.5932C4.67128 18.7931 4.23502 18.4761 4.31094 18.0631L5.28141 12.7833C5.31192 12.6173 5.25662 12.4471 5.13436 12.3308L1.24588 8.62979C0.941685 8.34027 1.10832 7.82742 1.52459 7.77199L6.84582 7.06343C7.01313 7.04115 7.15791 6.93597 7.2308 6.78373L9.54903 1.9419Z"
  //             fill="none"
  //             stroke="#333333"
  //             stroke-width="1.5"
  //             stroke-linecap="round"
  //             stroke-linejoin="round"
  //           />
  //         </svg>
  //       ),
  //       (
  //         <svg
  //           width="20"
  //           height="20"
  //           viewBox="0 0 20 20"
  //           fill="none"
  //           xmlns="http://www.w3.org/2000/svg"
  //         >
  //           <path
  //             d="M9.54903 1.9419C9.73038 1.56313 10.2696 1.56313 10.451 1.9419L12.7692 6.78373C12.8421 6.93597 12.9869 7.04115 13.1542 7.06343L18.4754 7.77199C18.8917 7.82742 19.0583 8.34027 18.7541 8.62979L14.8656 12.3308C14.7434 12.4471 14.6881 12.6173 14.7186 12.7833L15.6891 18.0631C15.765 18.4761 15.3287 18.7931 14.9594 18.5932L10.2379 16.0387C10.0895 15.9584 9.91052 15.9584 9.76207 16.0387L5.04063 18.5932C4.67128 18.7931 4.23502 18.4761 4.31094 18.0631L5.28141 12.7833C5.31192 12.6173 5.25662 12.4471 5.13436 12.3308L1.24588 8.62979C0.941685 8.34027 1.10832 7.82742 1.52459 7.77199L6.84582 7.06343C7.01313 7.04115 7.15791 6.93597 7.2308 6.78373L9.54903 1.9419Z"
  //             fill="none"
  //             stroke="#333333"
  //             stroke-width="1.5"
  //             stroke-linecap="round"
  //             stroke-linejoin="round"
  //           />
  //         </svg>
  //       )
  //     );
  //     m.badge = WKApp.shared.getFriendApplysUnreadCount();
  //     return m;
  //   },
  //   4000
  // );

  WKApp.route.register("/", () => {
    return <ChatPage />;
  });

  WKApp.route.register("/contacts", () => {
    return <ContactsList />;
  });
}

export default App;
